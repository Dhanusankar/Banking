# Render.com Blueprint for Banking AI POC
# This file enables one-click deployment of all 3 services

services:
  # 1. Java Backend Service
  - type: web
    name: banking-backend
    runtime: docker
    region: oregon
    plan: free
    dockerfilePath: ./backend-java/banking-backend/Dockerfile
    dockerContext: ./backend-java/banking-backend
    healthCheckPath: /api/balance?accountId=123
    envVars:
      - key: SERVER_PORT
        value: 8081
      - key: JAVA_OPTS
        value: -Xmx512m
    
  # 2. AI Orchestrator Service
  - type: web
    name: banking-orchestrator
    runtime: python
    region: oregon
    plan: free
    rootDir: ai-orchestrator
    buildCommand: pip install -r requirements_v2.txt
    startCommand: uvicorn server_v2:app --host 0.0.0.0 --port 8000
    healthCheckPath: /health
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.9
      - key: BACKEND_URL
        fromService:
          type: web
          name: banking-backend
          property: hostport
      - key: PORT
        value: 8000
      - key: PYTHONUNBUFFERED
        value: 1
    
  # 3. Streamlit UI Service
  - type: web
    name: banking-ui
    runtime: python
    region: oregon
    plan: free
    rootDir: ui
    buildCommand: pip install -r requirements.txt
    startCommand: streamlit run ui_v2.py --server.port 8501 --server.address 0.0.0.0
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.9
      - key: ORCHESTRATOR_URL
        fromService:
          type: web
          name: banking-orchestrator
          property: hostport
      - key: PORT
        value: 8501

databases:
  # SQLite runs in-container (for demo)
  # For production, add PostgreSQL:
  # - type: pserv
  #   name: banking-db
  #   plan: free
