<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banking LangGraph Workflow</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            padding: 40px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        .diagram-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .legend {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 20px;
            margin: 30px 0;
            border-radius: 5px;
        }
        .legend h3 {
            margin-top: 0;
            color: #2e7d32;
        }
        .legend-item {
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-radius: 5px;
        }
        .node-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        .node-type {
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .node-type h4 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        .validate { background: #e1f5ff; border-left: 4px solid #0288d1; }
        .confidence { background: #fff4e6; border-left: 4px solid #ff9800; }
        .prepare { background: #e8f5e9; border-left: 4px solid #4caf50; }
        .hil { background: #ffebee; border-left: 4px solid #f44336; }
        .execute { background: #f3e5f5; border-left: 4px solid #9c27b0; }
        .balance { background: #e0f2f1; border-left: 4px solid #009688; }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .metric {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¶ Banking AI Workflow</h1>
        <div class="subtitle">LangGraph + Llama-3 + Human-in-the-Loop</div>

        <div class="metrics">
            <div class="metric">
                <div class="metric-label">Confidence Threshold</div>
                <div class="metric-value">0.80</div>
            </div>
            <div class="metric">
                <div class="metric-label">HIL Value Threshold</div>
                <div class="metric-value">$5,000</div>
            </div>
            <div class="metric">
                <div class="metric-label">Total Nodes</div>
                <div class="metric-value">9</div>
            </div>
            <div class="metric">
                <div class="metric-label">LLM Model</div>
                <div class="metric-value" style="font-size: 1.5em;">Llama-3</div>
            </div>
        </div>

        <div class="diagram-container">
            <h2 style="text-align: center; color: #2c3e50;">Workflow Diagram</h2>
            <div class="mermaid">
graph TD
    __start__([üöÄ Start]) --> validate_input
    validate_input[üîç Validate Input<br/>Llama-3 Classification] --> confidence_check
    
    confidence_check{üéØ Confidence Check<br/>threshold: 0.80} --> |"‚â• 0.80<br/>High Confidence"| route_confidence{{üîÄ Route by Intent}}
    confidence_check --> |"< 0.80<br/>Low Conf Transfer"| money_transfer_hil
    confidence_check --> |"< 0.80<br/>Low Conf Other"| fallback
    
    route_confidence --> |balance_inquiry| balance_inquiry[üí∞ Balance Inquiry]
    route_confidence --> |money_transfer| money_transfer_prepare
    route_confidence --> |account_statement| account_statement[üìä Account Statement]
    route_confidence --> |loan_inquiry| loan_inquiry[üè¶ Loan Inquiry]
    route_confidence --> |fallback| fallback[‚ùì Fallback]
    
    money_transfer_prepare[üìù Prepare Transfer<br/>Build Request] --> route_transfer{{üîÄ Route Transfer}}
    route_transfer --> |"‚â• $5,000<br/>High Value"| money_transfer_hil[‚è∏Ô∏è HIL Approval<br/>Human Review]
    route_transfer --> |"Conversational<br/>Multi-turn"| money_transfer_hil
    route_transfer --> |"< $5,000<br/>Auto-Approve"| money_transfer_execute[‚úÖ Execute Transfer<br/>Call Backend]
    
    money_transfer_hil --> |"‚úÖ Approved"| money_transfer_execute
    money_transfer_hil --> |"‚ùå Rejected"| __end__
    
    balance_inquiry --> __end__([üèÅ End])
    money_transfer_execute --> __end__
    account_statement --> __end__
    loan_inquiry --> __end__
    fallback --> __end__
    
    style validate_input fill:#e1f5ff,stroke:#0288d1,stroke-width:3px
    style confidence_check fill:#fff4e6,stroke:#ff9800,stroke-width:3px
    style money_transfer_prepare fill:#e8f5e9,stroke:#4caf50,stroke-width:3px
    style money_transfer_hil fill:#ffebee,stroke:#f44336,stroke-width:3px
    style money_transfer_execute fill:#f3e5f5,stroke:#9c27b0,stroke-width:3px
    style balance_inquiry fill:#e0f2f1,stroke:#009688,stroke-width:3px
    style __start__ fill:#c8e6c9,stroke:#4caf50,stroke-width:3px
    style __end__ fill:#ffcdd2,stroke:#f44336,stroke-width:3px
    style fallback fill:#fce4ec,stroke:#e91e63,stroke-width:2px
    style account_statement fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
    style loan_inquiry fill:#fff3e0,stroke:#ff6f00,stroke-width:2px
            </div>
        </div>

        <div class="node-types">
            <div class="node-type validate">
                <h4>üîç Validate Input</h4>
                <p><strong>Purpose:</strong> LLM classification</p>
                <p><strong>Actions:</strong></p>
                <ul>
                    <li>Call Llama-3 via Ollama</li>
                    <li>Extract intent & entities</li>
                    <li>Merge conversational context</li>
                    <li>Return confidence score (0.0-1.0)</li>
                </ul>
            </div>

            <div class="node-type confidence">
                <h4>üéØ Confidence Check</h4>
                <p><strong>Purpose:</strong> Validation & routing</p>
                <p><strong>Actions:</strong></p>
                <ul>
                    <li>Check confidence ‚â• 0.80</li>
                    <li>Validate completeness</li>
                    <li>Store partial info in context</li>
                    <li>Detect conversational patterns</li>
                </ul>
            </div>

            <div class="node-type prepare">
                <h4>üìù Prepare Transfer</h4>
                <p><strong>Purpose:</strong> Transfer preparation</p>
                <p><strong>Actions:</strong></p>
                <ul>
                    <li>Build request_data</li>
                    <li>Check amount threshold</li>
                    <li>Set auto-approval flag</li>
                    <li>Validate entities</li>
                </ul>
            </div>

            <div class="node-type hil">
                <h4>‚è∏Ô∏è HIL Approval</h4>
                <p><strong>Purpose:</strong> Human verification</p>
                <p><strong>Triggers:</strong></p>
                <ul>
                    <li>Amount ‚â• $5,000</li>
                    <li>Conversational transfers</li>
                    <li>Low confidence transfers</li>
                    <li>Vague recipients</li>
                </ul>
            </div>

            <div class="node-type execute">
                <h4>‚úÖ Execute Transfer</h4>
                <p><strong>Purpose:</strong> Backend execution</p>
                <p><strong>Actions:</strong></p>
                <ul>
                    <li>Call backend API</li>
                    <li>Update balance</li>
                    <li>Clear conversational context</li>
                    <li>Return success/error</li>
                </ul>
            </div>

            <div class="node-type balance">
                <h4>üí∞ Balance Inquiry</h4>
                <p><strong>Purpose:</strong> Account balance</p>
                <p><strong>Actions:</strong></p>
                <ul>
                    <li>Query backend API</li>
                    <li>Get current balance</li>
                    <li>Format response</li>
                    <li>Return to user</li>
                </ul>
            </div>
        </div>

        <div class="legend">
            <h3>üìã Workflow Rules</h3>
            
            <div class="legend-item">
                <strong>üéØ Confidence Threshold:</strong> 0.80
                <br>Below this ‚Üí Low confidence handling (HIL or fallback)
            </div>

            <div class="legend-item">
                <strong>üí∞ Amount Threshold:</strong> $5,000
                <br>At or above ‚Üí Always requires HIL approval
            </div>

            <div class="legend-item">
                <strong>üîó Conversational Transfers:</strong> Always require HIL
                <br>Security measure when info spans multiple messages
            </div>

            <div class="legend-item">
                <strong>‚úÖ Auto-Approval:</strong> Transfers < $5,000 with complete info in single message
                <br>Bypass HIL for speed and efficiency
            </div>

            <div class="legend-item">
                <strong>‚è∏Ô∏è Checkpoint System:</strong> State saved at every node
                <br>Enables workflow resume after HIL approval
            </div>

            <div class="legend-item">
                <strong>üîÑ Conversational Context:</strong> Preserved within session
                <br>Fields: <code>context_amount</code>, <code>context_recipient</code>, <code>awaiting_completion</code>
            </div>
        </div>

        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-top: 30px;">
            <h3 style="color: #2c3e50;">üîß Implementation Details</h3>
            <ul style="line-height: 1.8;">
                <li><strong>LLM:</strong> Llama-3 8B (via Ollama on localhost:11434)</li>
                <li><strong>Framework:</strong> LangGraph with StateGraph</li>
                <li><strong>Backend:</strong> Java Spring Boot (Port 8081)</li>
                <li><strong>Orchestrator:</strong> FastAPI (Port 8000)</li>
                <li><strong>UI:</strong> Streamlit (Port 8501)</li>
                <li><strong>Storage:</strong> SQLite (checkpoints & sessions)</li>
                <li><strong>State Type:</strong> TypedDict with 15+ fields</li>
                <li><strong>Nodes:</strong> 9 total (6 functional + 3 utility)</li>
                <li><strong>Edges:</strong> Conditional routing with state-based decisions</li>
            </ul>
        </div>

        <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #ecf0f1; color: #7f8c8d;">
            <p>Banking AI POC ‚Ä¢ November 2025 ‚Ä¢ Developer: Dhanu</p>
            <p style="font-size: 0.9em;">LangGraph + Llama-3 + HIL Approval System</p>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis',
                padding: 20
            }
        });
    </script>
</body>
</html>
